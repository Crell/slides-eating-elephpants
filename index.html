<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">

    <title>Turning Big Ships</title>

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="css/reveal.min.css">
    <link rel="stylesheet" href="palantir/palantir.css" id="theme">

    <!-- For syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- If the query includes 'print-pdf', use the PDF print sheet -->
    <script>
      document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->

    <style>

      dl dt {
        text-align: left;
      }

      dl dd {
        margin-left: 2em;
        text-align: left;
      }

      .struck {
        text-decoration: line-through;
      }

    </style>


    <script>
(function() {
  // Classer utility. When a fragment with data-classer is shown, some other
  // element withthe ID specified with data-classer will get the class specified
  // by data-classer-class added to it. When the fragment is hidden the class
  // will be removed.

  var classerIndex;

  document.addEventListener('DOMContentLoaded', function() {
    Array.prototype.forEach.call(document.querySelectorAll('[data-classer]'), function(el, i) {
      // If there's no ID, set one.
      el.id = el.id || 'classer-' + classerIndex++;
      runClasser(el.id, el.getAttribute('data-classer'), el.getAttribute('data-classer-class'));
    });
  });

  var runClasser = function(id, targetId, targetClass) {
    if (!targetId || !targetClass) {
      return;
    }
    Reveal.addEventListener('fragmentshown', function(event) {
      if (event.fragment.id === id) {
        document.getElementById(targetId).classList.add(targetClass);
      }
    });
    Reveal.addEventListener('fragmenthidden', function(event) {
      if (event.fragment.id === id) {
        document.getElementById(targetId).classList.remove(targetClass);
      }
    });
  };

})();
    </script>


  </head>

  <body>
    <div class="reveal">

      <div class="slides">
        <section>
          <h1>Turning Big Ships</h1>
          <p>
            <small>Presented by <a href="http://www.garfieldtech.com/">Larry Garfield</a> (<a href="http://twitter.com/Crell">@Crell</a>)</small>
          </p>
        </section>
        <section>
          <h2><a href="http://twitter.com/Crell">@Crell</a></h2>
          <img src="palantir/palantirnet-logo-4c-reversed.svg" alt="Palantir.net Pays me!" style="width: 300px; float: right;" />
          <ul>
            <li>Senior Architect, <a href="http://www.palantir.net/">Palantir.net</a></li>
            <li>Drupal 8 Web Services Lead</li>
            <li>Drupal Representative, <a href="http://www.php-fig.org/">PHP-FIG</a></li>
            <li>Advisor, Drupal Association</li>
            <li>Loveable pedant</li>
          </ul>
        </section>

        <section>
          <section data-background="assets/duplo-kids.jpg" data-credit="https://www.flickr.com/photos/ianus/9373214">
            <aside class="notes">
              Who's excited to write code like this?
            </aside>
          </section>
          <section data-background="assets/spaghetti.jpg" data-credit="https://www.flickr.com/photos/hatm/5704123809">
            <aside class="notes">
              Going home to this?
            </aside>
          </section>
        </section>

        <section>
          <section>
            <h2>The goal</h2>
            <p class="bigtext fragment" id="no-legacy-code">No legacy code</p>
            <p class="bigtext fragment" data-classer="no-legacy-code" data-classer-class="struck">Less legacy code</p>
          </section>
          <section>
            <h2>Legacy code</h2>
            <ul>
              <li class="fragment" id="code-didnt-write"><em>noun</em>: Code I didn't write</li>
              <li class="fragment" id="code-without-tests" data-classer="code-didnt-write" data-classer-class="struck"><em>noun</em>: Code without unit tests</li>
              <li class="fragment" data-classer="code-without-tests" data-classer-class="struck"><em>noun</em>: Code worth testing that cannot be unit tested</li>
            </ul>
          </section>
          <section>
            <p class="bigtext">Testable code</p>
            <div class="fragment">
              <p>Stand in for</p>
              <ul>
                <li>Loosely coupled / Uncoupled</li>
                <li>Injectable</li>
                <li>Modern</li>
                <li>"Good"</li>
              </ul>
            </div>
          </section>
          <section>
            <img src="assets/druplicon.svg" style="" alt="Druplicon" />
            <p class="fragment">If we can do it, so can you</p>
          </section>
        </section>
        <section>
          <section>
            <img src="assets/drupal-7-logo.jpg" style="height: 200px;" alt="Drupal 7" data-credit="https://association.drupal.org/files/drupal-7-logo.jpg" />
            <ul>
              <li class="fragment">PHP4-era Procedural</li>
              <li class="fragment">Array-oriented</li>
              <li class="fragment">Lots of functional tests</li>
              <li class="fragment">"Unique" (but extensible) architecture</li>
              <li class="fragment">Runs 2% of the web</li>
              <li class="fragment">Massive community</li>
            </ul>
            <p style="clear: both; margin-top: 2em;" class="fragment">Very powerful, but straining at the seams</p>
          </section>
          <section>
            <img src="assets/drupal-8-logo.png"  style="height: 200px;" alt="Drupal 8" data-credit="https://drupal.org/node/2119739" />
            <ul>
              <li class="fragment">Architecturally OOP</li>
              <li class="fragment">4600 unit tests (and counting)</li>
              <li class="fragment">Flexible architecture</li>
              <li class="fragment">Even bigger community</li>
            </ul>
            <p style="clear: both; margin-top: 2em;" class="fragment">How'd they do that?</p>
          </section>
          <section>
            <h3>How does one eat an elePHPant?</h3>
            <img src="assets/eat-elephpant.jpg" alt="How do you eat an elephant?" />
          </section>
          <section>
            <h3>One bite at a time...</h3>
            <img src="assets/eat-elephpants-mini.jpg" alt="One bite at a time" />
          </section>
          <section>
            <h3>... with friends</h3>
            <img src="assets/eat-elephpants-friends.jpg" alt="With friends" />
          </section>
          <section>
            <h3>... with <em>lots</em> of friends</h3>
            <img src="assets/drupalcon-portland.jpg" alt="DrupalCon Portland" />
          </section>
        </section>
        <section>
          <section data-background="assets/drupal-delorean.jpg">
            <div style="font-weight: bold; position: relative; top: 10em; text-shadow: 2px 2px 2px #000;">
              <p>circa 2011</p>
            </div>
          </section>
          <section>
            <h2>WSCCI</h2>
            <p class="fragment">Web Services and Context Core Initiative</p>
            <blockquote class="fragment">Drupal needs to evolve, and quickly, from a
              first-class web CMS into a first-class REST server that includes a
              first-class web CMS.</blockquote>
          </section>
          <section>
            <p>Refactoring everything wasn't a goal, it was a methodology</p>
            <aside class="notes">
              <ul>
                <li>Wanted to do the new stuff "the right way" for its own sake</li>
                <li>Let it ripple out as it would</li>
                <li>We can't be the first to do this...</li>
              </ul>
            </aside>
          </section>
          <section>
            <img src="assets/drufony.png" alt="Drupal + Symfony = Drufony" style="max-height: 500px;" />
            <aside class="notes">
              <ul>
                <li>HttpInterface first, then Kernel, then snowball</li>
              </ul>
            </aside>
          </section>
          <section>
            <h2>Proudly Invented Elsewhere</h2>
            <ul class="fragment">
              <li>Symfony2 <small>(HttpFoundation, HttpKernel, DependencyInjection, EventDispatcher, Routing, Serializer, Validator, Yaml)</small></li>
              <li>Symfony CMF</li>
              <li>Zend Feed</li>
              <li>Doctrine Annotations</li>
              <li>Guzzle</li>
              <li>EasyRDF</li>
              <li>Assetic</li>
              <li>Twig</li>
            </ul>
          </section>
          <section>
            <p class="bigtext">Learn from our <span id="our-experience">experience</span> <span class="fragment" data-classer="our-experience" data-classer-class="struck">mistakes</span></p>
          </section>
        </section>
        <section>
          <section>
            <h2>#1</h2>
            <h2 class="fragment">Messaging matters</h2>
          </section>
          <section>
            <p>People need to see value</p>
            <p class="fragment">Developers need to see value</p>
            <p class="fragment">Management need to see value</p>
            <aside class="notes">
              <ul>
                <li>Drupal has management; Dries, Angie, companies, etc.</li>
                <li>You need buy-in</li>
              </ul>
            </aside>
          </section>
          <section>
            <p><q>Code quality doesn't matter, only user experience matters</q></p>
            <p class="fragment" style="margin-top: 2em;">Fire anyone who says this</p>
            <p class="fragment" style="margin-top: 2em;">Developers are users... <span class="fragment">of code</span></p>
            <aside class="notes">
              <ul>
                <li>UX depends on developer's ability to implement; bad code, no implementation</li>
              </ul>
            </aside>
          </section>
          <section>
            <p class="bigtext">Repeat your message</p>
            <p class="fragment">Everyone wants to hear the message themselves</p>
            <p class="fragment">Need to repeat it in different ways</p>
            <p class="fragment">It's a total waste of time... <span class="fragment">Do it anyway</span></p>
            <aside class="notes">
              <ul>
                <li>Blogs, IRC, pub. discussions, conferences</li>
                <li>Took a year for people to stop asking "so what is WSCCI?"</li>
              </ul>
            </aside>
          </section>
          <section>
            <p class="bigtext">Reiterate your message</p>
            <p class="fragment">Different people respond to different messaging</p>
            <p class="fragment">Everyone wants to feel special</p>
            <p class="fragment">It's a total waste of time... <span class="fragment">Do it anyway</span></p>
            <aside class="notes">
              <ul>
                <li>Politicians sound like canned responses because they are canned</li>
                <li>Took a year for people to stop asking "so what is WSCCI?"</li>
              </ul>
            </aside>
          </section>
        </section>
        <section>
          <section>
            <h2>#2</h2>
            <h2 class="fragment">Don't write unit tests</h2>
          </section>
          <section>
            <h2>Say WAT?</h2>
            <img src="assets/chris-hartjes-grumpy-cropped.jpg" alt="Grumpy does not approve!" style="height: 100%;" data-credit="https://www.flickr.com/photos/akrabat/8421560178/" />
          </section>
          <section>
            <h2>Write integration tests</h2>
            <ul>
              <li class="fragment">If your code were already testable we'd be done</li>
              <li class="fragment">Unit tests change with the unit</li>
              <li class="fragment">Unit test the new stuff</li>
              <li class="fragment">Don't break <em>user</em> functionality</li>
              <li class="fragment">100% green at all times</li>
            </ul>
          </section>
          <section>
            <p>Drupal wrote its own testing framework</p>
            <p class="fragment">(Please please do not do this)</p>
            <p class="fragment">Having those tests saved our butts</p>
            <p>
              <img class="fragment" src="assets/behat-logo.png" alt="Behat" style="background: lightgray;" />
              <img class="fragment" src="assets/selenium-logo.png" alt="Selenium" />
            </p>
          </section>
          <section>
            <p>Functional tests are for functionality... only</p>
            <p class="fragment">Pseudo-unit tests are worse than no tests</p>
          </section>
        </section>
        <section>
          <section>
            <h2>#3</h2>
            <h2 class="fragment">Establish a beachhead</h2>
          </section>
          <section>
            <p style="text-align: left;"><q>The new code will be better</q></p>
            <p style="text-align: right; margin-top: 1em;" class="fragment"><q>I'll believe it when I see it</q></p>
          </section>
          <section>
            <h2>DBTNG</h2>
            <ul>
              <li class="fragment">Drupal 7 DBAL</li>
              <li class="fragment">Home grown (Sorry, Doctrine)</li>
              <li class="fragment">98% OOP</li>
              <li class="fragment"><q>See, it's not so scary</q></li>
            </ul>
            <p style="margin-top: 1em;" class="fragment">c. 2008-2011</p>
          </section>
          <section>
            <h2>Routing / Web services</h2>
            <ul>
              <li class="fragment">REST-ify routing</li>
              <li class="fragment">Lots of Symfony code</li>
            </ul>
            <p class="fragment" style="margin-top: 1em;"><q>Throw HttpKernel in the middle<br />and let the chips fall where they may</q></p>
            <aside class="notes">
              <ul>
                <li>Old router only knew paths</li>
                <li>Symfony/CMF router knows full request</li>
                <li>The world didn't need another Request object</li>
              </ul>
            </aside>
          </section>
          <section>
            <h2>Goal: It's not so scary</h2>
            <h2 class="fragment">Goal: Demonstrate benefit</h2>
            <p class="fragment">(Shame the old code, not the old coders)</p>
            <aside class="notes">
              Make the old code feel clunkier, so people want to refactor it.
            </aside>
          </section>
          <section>
            <h2>Bottom up</h2>
            <div class="fragment" style="float: left; width: 48%">
              <h3>Pros</h3>
              <ul>
                <li class="fragment">Low-hanging fruit</li>
                <li class="fragment">Easier parallelism</li>
                <li class="fragment">Unravel knots bit by bit</li>
              </ul>
            </div>
            <div class="fragment" style="float: right; width: 48%">
              <h3>Cons</h3>
              <ul>
                <li class="fragment">Low-incentive</li>
                <li class="fragment">Less impactful</li>
                <li class="fragment">Staving off the big break</li>
              </ul>
            </div>
          </section>
          <section>
            <h2>Top down</h2>
            <div class="fragment" style="float: left; width: 48%">
              <h3>Pros</h3>
              <ul>
                <li class="fragment">Highest-visibility first</li>
                <li class="fragment">Identify the major knots</li>
                <li class="fragment">Better contrast w/ old code</li>
              </ul>
            </div>
            <div class="fragment" style="float: right; width: 48%">
              <h3>Cons</h3>
              <ul>
                <li class="fragment">Higher risk</li>
                <li class="fragment">So many knots...</li>
                <li class="fragment">Don't forget the low-fruit!</li>
              </ul>
            </div>
            <aside class="notes">
              <ul>
                <li>High risk = Not enough experience yet.</li>
                <li>low-fruit: check_markup() is still a function. WTF?</li>
              </ul>
            </aside>
          </section>
          <section>
            <blockquote>The right approach technically<br />and the right approach politically<br />may be completely different.</blockquote>
          </section>
        </section>
        <section>
          <section>
            <h2>#4</h2>
            <h3>Outsourcing is good for you</h3>
          </section>
          <section>
            <p>Modern PHP is all about sharing</p>
            <p class="fragment" style="margin-top: 1em;">It's way easier than it used to be.</p>
            <aside class="notes">
              <ul>
                <li>Composer, Symfony, Zend, Aura: Components FTW!</li>
                <li>Systems not built from components suck; replace them</li>
              </ul>
            </aside>
          </section>
          <section>
            <p style="text-align: left;"><q>I don't want to maintain [my] crappy code!</q></p>
            <p style="text-align: right; margin-top: 1em;" class="fragment"><q>So use someone else's</q></p>
            <p class="fragment roll-in" style="margin-top: 1em;">(Then they have to maintain it!)</p>
          </section>
          <section>
            <img src="assets/osi-symbol.png" style="width: 50%;" alt="The logo of the Open Source Initiative" data-credit="http://opensource.org/" />
            <h3>That's the point</h3>
          </section>
          <section>
            <h3>For new code</h3>
            <div class="fragment">
              <blockquote>Writing code should not be the 1st response. Finding if shared code exists should be the 1st response.</blockquote>
              <p>&mdash; <a href="https://twitter.com/e3BethT/status/457207489851686913">Beth Tucker-Long</a></p>
            </div>
            <p class="fragment" style="margin-top: 1em;">Drupal never seriously considered writing a YAML parser</p>
            <aside class="notes">
              <ul>
                <li>New Configuration system, uses YAML</li>
                <li>Uses Symfony YAML</li>
              </ul>
            </aside>
          </section>
          <section>
            <h3>For existing code</h3>
            <p>Refactor your app, don't replace it</p>
            <p class="fragment">Replace your component, don't refactor it</p>
          </section>
          <section>
            <h3><code id="dhr">drupal_http_request()</code></h3>
            <ul>
              <li class="fragment">HTTP/1.0 client</li>
              <li class="fragment">One function. No, really</li>
              <li class="fragment">Cyclomatic complexity: 41</li>
              <li class="fragment">N-Path complexity: 25,303,344,960</li>
              <li class="fragment">Lacking a number of features (proxy support)</li>
            </ul>
            <span class="fragment" data-classer="dhr" data-classer-class="struck"></span>
          </section>
          <section>
            <h3>Guzzle</h3>
            <p class="fragment">We did our research!</p>
            <ul>
              <li class="fragment">HTTP/1.1</li>
              <li class="fragment">Well-tested</li>
              <li class="fragment">Widely used</li>
              <li class="fragment">Loosely coupled</li>
              <li class="fragment">Way better than ours</li>
            </ul>
            <p class="fragment" style="margin-top: 1em;"><code>s/drupal_http_request()/Guzzle/</code></p>
          </section>
        </section>


        <div style="display:none">
          <div>
          Who's excited?
          Lego/Duplo (want to do this?)
          Spaghetti (going home to this)


          Legacy code: Code that is worth testing that is not easy to test
          Testing is your foot in the door.

          Story of Drupal 8: WSCCI, Symfony, Denver.  Functions to Objects.  DIC. PHPUnit coverage (compare)

          Lessons:

          * The importance of when
          ** Link to blog post, summarize?
          ** Scale, prioritization.

          * Don't do it all at once (big elephpant, small elephpants)
          ** "don’t look a progress horse in the mouth" -- Tim Plunkett

          * Repeat your message
          ** Every single person in the entire community will need it explained to them personally or they won't get it
          ** It sucks. It takes a long time. Deal.
          ** The right order technically and the right order politically may not line up. At all.

          * Don't write unit tests (do that while refactoring; start with functional tests with Behat/Selenium)
          ** The code will all be changing, don't make more work for yourself.  Unit test the new stuff.
          ** Drupal 7, lots of "deep functional" tests. Bad. Makes refactor slow.
          ** 100% green at all times!

          * Establish a beachhead
          ** DBTNG or Routing?
          ** Once you have that, things that touch it "ought to be refactored"; repeat
          ** Perhaps the beachhead should be lower-level.  Eg, check_markup() we STILL haven't gotten to.

          </div>

          * Undivided attention matters
          ** "Give me 5 people 10 hours a week, i can do anything. Give me 50 people one hour a week, I can't do shit."
          ** "if you give 3 people 3 days to work together on something, they’ll make unbelievable amounts of work done" -- Tim Plunkett (Sprints)

          * Service Locator (stepping stone)
          ** drupal_container() / \Drupal. Use for legacy, refactor incrementally.

          * Outsource all the things
          ** Symfony, Guzzle, Zend, etc.
          ** D8 nailed this.
          ** Don't outsource just for the sake of it.

          * Export your own code
          ** If you can't use it outside of your app... why?
          ** You probably couldn't test it, either.
          ** Drupal\Component\

          * Break things
          ** Code overhaul entails breakage. Deal.

          * Don't break things
          ** BC shims are your friend

          * Unbreak things
          ** Remember to remove BC shims!
          ** As soon as new mechanism is in place, old mechanism is verbotten.
          ** cache(), db_query(), base_path()
          ** Change notices help for communication.
          ** Code review is a HARD REQUIREMENT to ensure people switch; doubles odds one person knows about it.

          * Beware the bikeshed
          ** CMI file formats

          * Incremental progress
          ** Moving deck chairs on the titantic is OK if they get you closer to a life boat
          ** "No new features, so why do it?" -- BAD
          ** Initiatives: Too marketing/feature-driven.
          ** Session refactoring: Mega patch took 2 years. Incrementals, we've got 2 in.  Just moving code into classes first makes it easier to change the class later.  See: https://drupal.org/node/1858196
          ** "Procedural code inside class keywords" is forward progress.  Take it.  See also, FAPI: https://privatepaste.com/712522fdef
          ** Move files in one commit, change in another. Avoid confusing Git. Easier to review and rebase.

          * Tools
          ** Fuck patches (we screwed up on that one)
          ** Review all the things
          ** Automate all the things, esp. performance
          ** "When you commit enough regressions, it gets harder to measure new ones." --catch


          * The best is the enemy of the good
          ** Some fugly will remain
          ** Keep it contained
          ** Focus on the interface! Crap behind the interface is OK to refactor later.

          * You will never finish (Sissafus)

          * "No plan survives first contact with the enemy."
          * "Plans are useless; planning is everything."

          * It can be done: You have the technology
          ** If Drupal can get off the island, so can you

          * Check your ego at the door. Always.

        </div>

        <section id="final-slide">
          <h2>Larry Garfield</h2>
          <p>Senior Architect, <a href="http://www.palantir.net/">Palantir.net</a></p>
          <p>Making the Web a Better Place</p>
          <p>Keep tabs on our work at <a href="http://twitter.com/Palantir">@Palantir</a></p>
          <p>Want to hear about <a href="http://eepurl.com/ws6uj">what we're doing</a>?</p>
        </section>
      </div>
    </div>

    <footer class="palantir-logo">
      <a href="http://www.palantir.net/"><img src="palantir/palantirnet-logo-4c-reversed.svg" alt="Palantir.net logo" height="40" /></a>
    </footer>


    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.min.js"></script>

    <script>

      // Full list of configuration options available here:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,

        theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
        transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

        // Optional libraries used to extend on reveal.js
        dependencies: [
          { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
          { src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
        ]
      });

    </script>

  </body>
</html>

